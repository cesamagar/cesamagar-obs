<div style="background: #4caf50; color: white; padding: 5px; text-align: center; font-size: 12px;">
    SISTEMA DE ACORDES CARGADO
</div>

<script src="https://unpkg.com/chordsheetjs/dist/chordsheetjs.umd.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // Intentamos encontrar el bloque de varias formas por si el nombre cambia
    const blocks = document.querySelectorAll('pre code.language-chords, .language-chords');
    
    blocks.forEach((block, index) => {
        const rawContent = block.innerText;
        const parent = block.closest('pre'); // Buscamos el contenedor del cÃ³digo

        try {
            const parser = new ChordSheetJS.ChordsOverWordsParser();
            let song = parser.parse(rawContent);

            const container = document.createElement('div');
            container.style.cssText = "background:#1a1a1a; color:#ccc; padding:20px; border-radius:10px; margin:20px 0; border:1px solid #444;";
            
            const renderSong = (s) => new ChordSheetJS.HtmlTableFormatter().format(s);

            container.innerHTML = `
                <div style="margin-bottom:15px; display:flex; gap:10px;">
                    <button id="btn-down-${index}" style="padding:5px 15px; cursor:pointer;">-1 Semitono</button>
                    <button id="btn-up-${index}" style="padding:5px 15px; cursor:pointer;">+1 Semitono</button>
                </div>
                <div id="output-${index}">${renderSong(song)}</div>
            `;

            parent.replaceWith(container);

            container.querySelector(`#btn-up-${index}`).onclick = () => {
                song = song.transpose(1);
                container.querySelector(`#output-${index}`).innerHTML = renderSong(song);
            };
            container.querySelector(`#btn-down-${index}`).onclick = () => {
                song = song.transpose(-1);
                container.querySelector(`#output-${index}`).innerHTML = renderSong(song);
            };
        } catch (e) { console.error("Error en bloque", index, e); }
    });
});
</script>

<style>
    .chord { color: #5db9ff !important; font-weight: bold; height: 1.3em; }
    .lyrics { font-family: monospace; white-space: pre; }
    table { border-spacing: 0; margin-bottom: 5px; }
</style>
