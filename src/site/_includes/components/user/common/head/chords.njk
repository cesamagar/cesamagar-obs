<script src="https://unpkg.com/chordsheetjs/dist/chordsheetjs.umd.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // Buscamos bloques que Obsidian etiqueta como 'language-chords'
    const chordBlocks = document.querySelectorAll('pre code.language-chords');
    
    chordBlocks.forEach((block, index) => {
        const rawContent = block.innerText;
        const parent = block.closest('pre');

        try {
            // Usamos el parser de 'acordes sobre palabras' (tÃ­pico de Chord Sheets)
            const parser = new ChordSheetJS.ChordsOverWordsParser();
            let song = parser.parse(rawContent);
            const formatter = new ChordSheetJS.HtmlTableFormatter();

            const container = document.createElement('div');
            container.style.cssText = "background:#1e1e1e; color:#eee; padding:20px; border-radius:10px; margin:20px 0; border:1px solid #444; overflow-x:auto;";
            
            const render = (s) => formatter.format(s);

            container.innerHTML = `
                <div style="margin-bottom:15px; display:flex; gap:10px;">
                    <button id="up-${index}" style="padding:5px 10px; cursor:pointer;">+1 Tono</button>
                    <button id="down-${index}" style="padding:5px 10px; cursor:pointer;">-1 Tono</button>
                </div>
                <div id="canvas-${index}">${render(song)}</div>
            `;

            parent.replaceWith(container);

            container.querySelector(`#up-${index}`).onclick = () => {
                song = song.transpose(1);
                container.querySelector(`#canvas-${index}`).innerHTML = render(song);
            };
            container.querySelector(`#down-${index}`).onclick = () => {
                song = song.transpose(-1);
                container.querySelector(`#canvas-${index}`).innerHTML = render(song);
            };
        } catch (e) {
            console.error("Error procesando acordes:", e);
        }
    });
});
</script>

<style>
    /* Estilos para que los acordes se vean bien sobre la letra */
    .chord { color: #5db9ff !important; font-weight: bold; height: 1.3em; display: block; }
    .lyrics { font-family: 'Courier New', monospace; white-space: pre; color: #ccc; }
    table { border-spacing: 0; margin-bottom: 5px; }
</style>
