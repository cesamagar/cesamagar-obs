<div style="background: red; color: white; padding: 10px; text-align: center;">¡EL SCRIPT SE ESTÁ CARGANDO!</div>
<script src="https://unpkg.com/chordsheetjs/dist/chordsheetjs.umd.js"></script>

<style>
    .chord-sheet-container {
        background: #1e1e1e;
        color: #d4d4d4;
        padding: 1.5rem;
        border-radius: 8px;
        margin: 1rem 0;
        font-family: 'Fira Code', monospace;
        overflow-x: auto;
        border: 1px solid #333;
    }
    .chord-controls { margin-bottom: 1rem; display: flex; gap: 10px; align-items: center; }
    .chord-btn {
        background: #3a3a3a;
        color: white;
        border: 1px solid #555;
        padding: 5px 12px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.8rem;
    }
    .chord-btn:hover { background: #505050; }
    .chord-sheet-canvas .chord { color: #ff9d00; font-weight: bold; height: 1.2rem; }
    .chord-sheet-canvas .row { display: flex; flex-direction: column; margin-bottom: 5px; }
    .chord-sheet-canvas .column { display: inline-flex; flex-direction: column; margin-right: 4px; }
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const blocks = document.querySelectorAll('pre code.language-chords');
    blocks.forEach((block, index) => {
        const rawContent = block.innerText;
        const parent = block.parentElement;
        const container = document.createElement('div');
        container.className = 'chord-sheet-container';
        
        const parser = new ChordSheetJS.ChordsOverWordsParser();
        let song = parser.parse(rawContent);
        let currentKey = 0;

        const render = (s) => { return new ChordSheetJS.HtmlTableFormatter().format(s); };
        const updateHTML = () => { container.querySelector('.chord-sheet-canvas').innerHTML = render(song); };

        container.innerHTML = `
            <div class="chord-controls">
                <button class="chord-btn" id="down-${index}">-1 Semitono</button>
                <button class="chord-btn" id="up-${index}">+1 Semitono</button>
                <span style="font-size: 0.8rem; color: #888;">Tono: <span id="key-${index}">0</span></span>
            </div>
            <div class="chord-sheet-canvas"></div>
        `;
        parent.replaceWith(container);
        updateHTML();

        container.querySelector(`#up-${index}`).addEventListener('click', () => {
            song = song.transpose(1); currentKey++;
            container.querySelector(`#key-${index}`).innerText = (currentKey > 0 ? '+' : '') + currentKey;
            updateHTML();
        });
        container.querySelector(`#down-${index}`).addEventListener('click', () => {
            song = song.transpose(-1); currentKey--;
            container.querySelector(`#key-${index}`).innerText = (currentKey > 0 ? '+' : '') + currentKey;
            updateHTML();
        });
    });
});
</script>
